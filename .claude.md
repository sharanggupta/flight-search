# Flight Search Project - Claude Code Guidelines

## Project Overview
This is a Spring Boot application for flight search functionality. The project uses:
- Spring Boot 3.4.0
- Java 21 (LTS)
- Maven
- PostgreSQL Database
- Lombok for boilerplate reduction
- Spring Data JPA
- Spring Web (REST APIs)
- TestContainers for E2E testing
- WebTestClient for E2E HTTP calls

## Architecture
**Hexagonal Architecture (Ports and Adapters)**
```
flight-search/
├── src/
│   ├── main/
│   │   ├── java/com/example/flightsearch/
│   │   │   ├── domain/           # Domain model (core business logic)
│   │   │   ├── application/      # Application services (use cases)
│   │   │   │   ├── port/
│   │   │   │   │   ├── in/      # Input ports (interfaces for use cases)
│   │   │   │   │   └── out/     # Output ports (interfaces for persistence, etc.)
│   │   │   │   └── service/     # Application service implementations
│   │   │   ├── adapter/
│   │   │   │   ├── in/
│   │   │   │   │   └── web/     # REST controllers
│   │   │   │   └── out/
│   │   │   │       └── persistence/ # JPA repositories & entities
│   │   │   └── FlightSearchApplication.java
│   │   └── resources/
│   │       └── application.properties
│   └── test/
│       └── java/com/example/flightsearch/
│           ├── e2e/              # End-to-end tests
│           └── unit/             # Unit tests
├── pom.xml
└── .claude.md (this file)
```

## Development Workflow

### Double-Loop TDD Practice
**ALWAYS follow this workflow when implementing new features:**

1. **Outer Loop - E2E Test (Red)**
   - Write a failing end-to-end test first
   - E2E test should spin up the full application using TestContainers
   - Make real HTTP calls to the application
   - Run: `./mvnw verify -Dtest=E2E*`

2. **Inner Loop - Unit Tests (Red-Green-Refactor)**
   - Write failing unit tests for the components needed
   - Implement the **simplest possible code** to make tests pass
   - **Including hardcoded return values** - this is intentional and correct
   - Run: `./mvnw test`
   - Refactor while keeping tests green

3. **Outer Loop - E2E Verification (Green)**
   - Return to E2E test and verify it passes
   - If it fails, add more unit tests and repeat inner loop

4. **Commit**
   - When tests are passing, commit the changes
   - Commit message should reflect the feature/behavior added

### Testing Commands

**Unit Tests Only:**
```bash
./mvnw test
```

**E2E Tests Only:**
```bash
./mvnw verify -Dtest=E2E*
```

**All Tests:**
```bash
./mvnw verify
```

## Code Style

### Clean Code Principles (Bob Martin)
- **Single Responsibility Principle**: Each class should have one reason to change
- **Open/Closed Principle**: Open for extension, closed for modification
- **Dependency Inversion**: Depend on abstractions, not concretions
- **Small Functions**: Functions should be small and do one thing well
- **Meaningful Names**: Use intention-revealing names
- **Don't Repeat Yourself (DRY)**
- **Boy Scout Rule**: Leave code cleaner than you found it

### Java & Spring Boot Conventions
- Use dependency injection (constructor injection preferred)
- Use Lombok to reduce boilerplate (@Data, @Builder, @AllArgsConstructor, etc.)
- Follow standard Java naming conventions
- Use Optional for potentially null values
- Prefer composition over inheritance
- Use interfaces to define contracts (ports in hexagonal architecture)

### Hexagonal Architecture Guidelines
- **Domain layer**: Pure business logic, no framework dependencies
- **Application layer**: Use cases and ports (interfaces)
- **Adapters**: Framework-specific implementations (web, persistence)
- **Dependency rule**: Dependencies point inward (adapters → application → domain)

## Testing Guidelines

### Unit Tests
- Test behavior, not implementation
- Use meaningful test method names (should/when pattern)
- Follow AAA pattern: Arrange, Act, Assert
- Mock external dependencies
- Keep tests fast and isolated
- **TDD: Write simplest code to pass, including hardcoded values**

### E2E Tests
- Use TestContainers to spin up real dependencies
- Make real HTTP calls using RestTemplate or WebTestClient
- Test complete user journeys
- Verify system behavior from outside
- Place in `src/test/java/.../e2e/` package

### Test Naming
- Unit tests: `ClassNameTest.java`
- E2E tests: `E2EFeatureNameTest.java`
- Test methods: `shouldDoSomething_whenCondition()` or `givenCondition_whenAction_thenResult()`

## Running the Application
```bash
./mvnw spring-boot:run
```

## Building the Application
```bash
./mvnw clean package
```

## Database
- Using H2 in-memory database for development
- H2 Console can be enabled for debugging
- TestContainers for E2E tests with real database

## Git Workflow
- Commit when tests are passing
- Write descriptive commit messages
- Small, focused commits preferred
- Don't commit failing tests

## Future Enhancements
- Add authentication/authorization
- Implement caching
- Add API documentation (Swagger/OpenAPI)
- Add logging and monitoring
- Implement pagination for search results
- Add comprehensive error handling and validation
