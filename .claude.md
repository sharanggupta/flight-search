# Flight Search Project - Claude Code Guidelines

## Project Overview
This is a Spring Boot application for flight search functionality. The project uses:
- Spring Boot 3.4.0
- Java 21 (LTS)
- Maven
- PostgreSQL Database
- Lombok for boilerplate reduction
- Spring Data JPA
- Spring Web (REST APIs)
- TestContainers for E2E testing
- WebTestClient for E2E HTTP calls

## Architecture
**Hexagonal Architecture (Ports and Adapters)**
```
flight-search/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/example/flightsearch/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/           # Domain model (core business logic)
â”‚   â”‚   â”‚   â”œâ”€â”€ application/      # Application services (use cases)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ port/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ in/      # Input ports (interfaces for use cases)
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ out/     # Output ports (interfaces for persistence, etc.)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ service/     # Application service implementations
â”‚   â”‚   â”‚   â”œâ”€â”€ adapter/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ in/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ web/     # REST controllers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ out/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ persistence/ # JPA repositories & entities
â”‚   â”‚   â”‚   â””â”€â”€ FlightSearchApplication.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.properties
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/example/flightsearch/
â”‚           â”œâ”€â”€ e2e/              # End-to-end tests
â”‚           â””â”€â”€ unit/             # Unit tests
â”œâ”€â”€ pom.xml
â””â”€â”€ .claude.md (this file)
```

## Development Workflow

### Double-Loop TDD Practice
**ALWAYS follow this workflow when implementing new features:**

1. **Outer Loop - E2E Test (Red)**
   - Write a failing end-to-end test first
   - E2E test should spin up the full application using TestContainers
   - Make real HTTP calls to the application
   - Run: `./mvnw verify -Dtest=E2E*`

2. **Inner Loop - Unit Tests (Red-Green-Refactor)**
   - Write failing unit tests for the components needed
   - Implement the **simplest possible code** to make tests pass
   - **Including hardcoded return values** - this is intentional and correct
   - Run: `./mvnw test`
   - Refactor while keeping tests green
   - **IMPORTANT: Commit and push immediately when unit tests pass**

3. **Outer Loop - E2E Verification (Green)**
   - Return to E2E test and verify it passes
   - If it fails, add more unit tests and repeat inner loop
   - **Verify feature is truly complete** - ensure service uses repository, not hardcoded data
   - E2E test must seed real test data

4. **Commit and Push**
   - **Commit and push after each passing unit test**
   - **Commit and push when E2E tests pass**
   - Commit message should reflect the feature/behavior added
   - Use conventional commit format with detailed description

### Testing Commands

**Unit Tests Only (all tests except E2E):**
```bash
./mvnw test -Dtest="!E2E*"
```

**E2E Tests Only:**
```bash
./mvnw test -Dtest="E2E*"
```

**All Tests:**
```bash
./mvnw test
```

## Code Style

### Clean Code Principles (Bob Martin)
- **Single Responsibility Principle**: Each class should have one reason to change
- **Open/Closed Principle**: Open for extension, closed for modification
- **Dependency Inversion**: Depend on abstractions, not concretions
- **Small Functions**: Functions should be small and do one thing well
- **Meaningful Names**: Use intention-revealing names
- **Don't Repeat Yourself (DRY)**
- **Boy Scout Rule**: Leave code cleaner than you found it

### Java & Spring Boot Conventions
- Use dependency injection (constructor injection preferred)
- Use Lombok to reduce boilerplate (@Data, @Builder, @AllArgsConstructor, etc.)
- Follow standard Java naming conventions
- Use Optional for potentially null values
- Prefer composition over inheritance
- Use interfaces to define contracts (ports in hexagonal architecture)

### Hexagonal Architecture Guidelines
- **Domain layer**: Pure business logic, no framework dependencies
- **Application layer**: Use cases and ports (interfaces)
- **Adapters**: Framework-specific implementations (web, persistence)
- **Dependency rule**: Dependencies point inward (adapters â†’ application â†’ domain)

## Testing Guidelines

### Unit Tests
- Test behavior, not implementation
- Use meaningful test method names (should/when pattern)
- Follow AAA pattern: Arrange, Act, Assert
- Mock external dependencies
- Keep tests fast and isolated
- **TDD: Write simplest code to pass, including hardcoded values**

### E2E Tests
- Use TestContainers to spin up real dependencies
- Make real HTTP calls using RestTemplate or WebTestClient
- Test complete user journeys
- Verify system behavior from outside
- Place in `src/test/java/.../e2e/` package

### Test Naming Conventions
**Unit Tests:**
- Naming: `ClassNameTest.java` (e.g., `SearchFlightsServiceTest.java`, `FlightControllerTest.java`)
- Location: `src/test/java/.../` (mirror main source structure)
- Run with: `./mvnw test -Dtest="!E2E*"`

**E2E Tests:**
- Naming: `E2EFeatureNameTest.java` (e.g., `E2EFlightSearchTest.java`)
- Location: `src/test/java/.../e2e/`
- Run with: `./mvnw test -Dtest="E2E*"`
- Must use `@SpringBootTest` with TestContainers

**Test Methods:**
- Format: `shouldDoSomething_whenCondition()`
- Alternative: `givenCondition_whenAction_thenResult()`
- Examples:
  - `shouldReturnFlightsFromOriginAirport()`
  - `shouldReturn404_whenOriginNotFound()`
  - `givenValidFlight_whenSaving_thenReturnsSavedFlight()`

## Running the Application
```bash
./mvnw spring-boot:run
```

## Building the Application
```bash
./mvnw clean package
```

## Database
- Using H2 in-memory database for development
- H2 Console can be enabled for debugging
- TestContainers for E2E tests with real database

## Git Workflow

### Commit Frequency
- **MUST commit and push after each passing unit test**
- **MUST commit and push when E2E tests pass**
- **MUST commit and push when feature is truly complete**
- Never commit failing tests
- Small, focused commits are better than large ones

### Commit Message Format
```
<type>: <short summary>

<detailed description of what was done and why>

TDD cycle: [Red/Green/Refactor stage]

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### When to Commit
1. âœ… Unit tests passing (even with hardcoded implementation)
2. âœ… E2E tests passing
3. âœ… Feature complete and verified
4. âœ… Refactoring complete (tests still green)
5. âŒ Never commit broken/failing tests

### Push After Every Commit
- Always push immediately after committing
- Keep remote repository in sync
- Command: `git commit -m "..." && git push`

## Future Enhancements
- Add authentication/authorization
- Implement caching
- Add API documentation (Swagger/OpenAPI)
- Add logging and monitoring
- Implement pagination for search results
- Add comprehensive error handling and validation
